name: Lab 3 Grading
on:
  push:
    branches: [ "main", "autogradetest" ]

jobs:
  grade:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Run Tests and Calculate Grade
        run: |
          # --- ADJUST POINT VALUES HERE ---
          T1_PTS=10
          T2_PTS=15
          T3_PTS=15
          T4_PTS=20
          T5_PTS=20
          T6_PTS=20
          # --------------------------------
          
          TOTAL_SCORE=0
          
          echo "### Lab 3 Results" >> $GITHUB_STEP_SUMMARY
          echo "| Task | Points Possible | Status | Score |" >> $GITHUB_STEP_SUMMARY
          echo "| --- | --- | --- | --- |" >> $GITHUB_STEP_SUMMARY

          # Helper function to run tests
          run_test() {
            local task_num=$1
            local pts=$2
            
            if javac Lab3.java TestTask$task_num.java && java TestTask$task_num > /dev/null 2>&1; then
              echo "| Task $task_num | $pts | ✅ Passed | $pts |" >> $GITHUB_STEP_SUMMARY
              TOTAL_SCORE=$((TOTAL_SCORE + pts))
            else
              echo "| Task $task_num | $pts | ❌ Failed | 0 |" >> $GITHUB_STEP_SUMMARY
            fi
          }

          # Execute the tests with your defined points
          run_test 1 $T1_PTS
          run_test 2 $T2_PTS
          run_test 3 $T3_PTS
          run_test 4 $T4_PTS
          run_test 5 $T5_PTS
          run_test 6 $T6_PTS

          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## Final Grade: $TOTAL_SCORE / 100" >> $GITHUB_STEP_SUMMARY