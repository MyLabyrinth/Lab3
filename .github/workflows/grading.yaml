name: Lab 3 Grading
on:
  push:
    branches: [ "main", "autogradetest" ]

jobs:
  grade:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          
      - name: Debug - List Files
        run: ls -R

      - name: Run Tests and Calculate Grade
        run: |
          TOTAL_SCORE=0
          echo "### Lab 3 Results" >> $GITHUB_STEP_SUMMARY
          echo "| Task | Points Possible | Status | Score |" >> $GITHUB_STEP_SUMMARY
          echo "| --- | --- | --- | --- |" >> $GITHUB_STEP_SUMMARY

          # Task 1
          echo "Compiling Task 1..."
          if javac Lab3.java TestTask1.java && java TestTask1; then
            echo "| Task 1 | 10 | ✅ Passed | 10 |" >> $GITHUB_STEP_SUMMARY
            TOTAL_SCORE=$((TOTAL_SCORE + 10))
          else
            echo "| Task 1 | 10 | ❌ Failed | 0 |" >> $GITHUB_STEP_SUMMARY
          fi

          # Task 2
          echo "Compiling Task 2..."
          if javac Lab3.java TestTask2.java && java TestTask2; then
            echo "| Task 2 | 15 | ✅ Passed | 15 |" >> $GITHUB_STEP_SUMMARY
            TOTAL_SCORE=$((TOTAL_SCORE + 15))
          else
            echo "| Task 2 | 15 | ❌ Failed | 0 |" >> $GITHUB_STEP_SUMMARY
          fi

          # Task 3
          echo "Compiling Task 3..."
          if javac Lab3.java TestTask3.java && java TestTask3; then
            echo "| Task 3 | 15 | ✅ Passed | 15 |" >> $GITHUB_STEP_SUMMARY
            TOTAL_SCORE=$((TOTAL_SCORE + 15))
          else
            echo "| Task 3 | 15 | ❌ Failed | 0 |" >> $GITHUB_STEP_SUMMARY
          fi

          # Task 4
          echo "Compiling Task 4..."
          if javac Lab3.java TestTask4.java && java TestTask4; then
            echo "| Task 4 | 20 | ✅ Passed | 20 |" >> $GITHUB_STEP_SUMMARY
            TOTAL_SCORE=$((TOTAL_SCORE + 20))
          else
            echo "| Task 4 | 20 | ❌ Failed | 0 |" >> $GITHUB_STEP_SUMMARY
          fi

          # Task 5
          echo "Compiling Task 5..."
          if javac Lab3.java TestTask5.java && java TestTask5; then
            echo "| Task 5 | 20 | ✅ Passed | 20 |" >> $GITHUB_STEP_SUMMARY
            TOTAL_SCORE=$((TOTAL_SCORE + 20))
          else
            echo "| Task 5 | 20 | ❌ Failed | 0 |" >> $GITHUB_STEP_SUMMARY
          fi

          # Task 6
          echo "Compiling Task 6..."
          if javac Lab3.java TestTask6.java && java TestTask6; then
            echo "| Task 6 | 20 | ✅ Passed | 20 |" >> $GITHUB_STEP_SUMMARY
            TOTAL_SCORE=$((TOTAL_SCORE + 20))
          else
            echo "| Task 6 | 20 | ❌ Failed | 0 |" >> $GITHUB_STEP_SUMMARY
          fi

          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## Final Grade: $TOTAL_SCORE / 100" >> $GITHUB_STEP_SUMMARY